/* Novel ProseMirror Styles */
/* Based on https://github.com/steven-tey/novel */

/* Novel stone colors for drag handle (moved here from inline vars) */
:root {
  --novel-stone-50: #fafaf9;
  --novel-stone-100: #f5f5f4;
  --novel-stone-200: #e7e5e4;
  --novel-stone-300: #d6d3d1;
  --novel-stone-400: #a8a29e;
  --novel-stone-500: #78716c;
  --novel-stone-600: #57534e;
  --novel-stone-700: #44403c;
  --novel-stone-800: #292524;
  --novel-stone-900: #1c1917;
}

/* === ProseMirror Base Styles === */
.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0;
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection {
  caret-color: transparent;
}

.ProseMirror-selectednode {
  outline: 3px solid #5abbf7;
}

/* === Placeholder (Ãºnica regra) === */
.ProseMirror p.is-editor-empty:first-child::before {
  content: attr(data-placeholder);
  float: left;
  color: hsl(var(--muted-foreground));
  pointer-events: none;
  height: 0;
}

/* === Images === */
.ProseMirror img {
  transition: filter 0.1s ease-in-out;
  max-width: 100%;
  height: auto;
}

.ProseMirror img:hover {
  cursor: pointer;
  filter: brightness(90%);
}

.ProseMirror img.ProseMirror-selectednode {
  outline: 3px solid #5abbf7;
  filter: brightness(90%);
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
}

/* === Drag Handle (Global) === */
.drag-handle {
  /* Keep positioned relative to viewport but align with editor gutter */
  position: fixed;
  opacity: 1;
  transition: opacity ease-in 0.2s;
  border-radius: 0.25rem;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 10' style='fill: rgba(0, 0, 0, 0.5)'%3E%3Cpath d='M3,2 C2.44771525,2 2,1.55228475 2,1 C2,0.44771525 2.44771525,0 3,0 C3.55228475,0 4,0.44771525 4,1 C4,1.55228475 3.55228475,2 3,2 Z M3,6 C2.44771525,6 2,5.55228475 2,5 C2,4.44771525 2.44771525,4 3,4 C3.55228475,4 4,4.44771525 4,5 C4,5.55228475 3.55228475,6 3,6 Z M3,10 C2.44771525,10 2,9.55228475 2,9 C2,8.44771525 2.44771525,8 3,8 C3.55228475,8 4,8.44771525 4,9 C4,9.55228475 3.55228475,10 3,10 Z M7,2 C6.44771525,2 6,1.55228475 6,1 C6,0.44771525 6.44771525,0 7,0 C7.55228475,0 8,0.44771525 8,1 C8,1.55228475 7.55228475,2 7,2 Z M7,6 C6.44771525,6 6,5.55228475 6,5 C6,4.44771525 6.44771525,4 7,4 C7.55228475,4 8,4.44771525 8,5 C8,5.55228475 7.55228475,6 7,6 Z M7,10 C6.44771525,10 6,9.55228475 6,9 C6,8.44771525 6.44771525,8 7,8 C7.55228475,8 8,8.44771525 8,9 C8,9.55228475 7.55228475,10 7,10 Z'%3E%3C/path%3E%3C/svg%3E");
  background-size: calc(0.5em + 0.375rem) calc(0.5em + 0.375rem);
  background-repeat: no-repeat;
  background-position: center;
  width: 1.2rem;
  height: 1.5rem;
  z-index: 50;
  cursor: grab;
  /* Align handle with the left gutter of the editor.
    Primary: CSS var provided by NovelEditor. Fallback: clamp by container width. */
  left: var(--drag-handle-left, clamp(12px, calc((100vw - 1024px) / 2 - 36px), 200px)) !important;
}

.drag-handle:hover {
  background-color: var(--novel-stone-100);
  transition: background-color 0.2s;
}

.drag-handle:active {
  background-color: var(--novel-stone-200);
  transition: background-color 0.2s;
  cursor: grabbing;
}

.drag-handle.hide {
  opacity: 0;
  pointer-events: none;
}

@media screen and (max-width: 600px) {
  .drag-handle {
    display: none;
    pointer-events: none;
  }
}

.dark .drag-handle {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 10' style='fill: rgba(255, 255, 255, 0.5)'%3E%3Cpath d='M3,2 C2.44771525,2 2,1.55228475 2,1 C2,0.44771525 2.44771525,0 3,0 C3.55228475,0 4,0.44771525 4,1 C4,1.55228475 3.55228475,2 3,2 Z M3,6 C2.44771525,6 2,5.55228475 2,5 C2,4.44771525 2.44771525,4 3,4 C3.55228475,4 4,4.44771525 4,5 C4,5.55228475 3.55228475,6 3,6 Z M3,10 C2.44771525,10 2,9.55228475 2,9 C2,8.44771525 2.44771525,8 3,8 C3.55228475,8 4,8.44771525 4,9 C4,9.55228475 3.55228475,10 3,10 Z M7,2 C6.44771525,2 6,1.55228475 6,1 C6,0.44771525 6.44771525,0 7,0 C7.55228475,0 8,0.44771525 8,1 C8,1.55228475 7.55228475,2 7,2 Z M7,6 C6.44771525,6 6,5.55228475 6,5 C6,4.44771525 6.44771525,4 7,4 C7.55228475,4 8,4.44771525 8,5 C8,5.55228475 7.55228475,6 7,6 Z M7,10 C6.44771525,10 6,9.55228475 6,9 C6,8.44771525 6.44771525,8 7,8 C7.55228475,8 8,8.44771525 8,9 C8,9.55228475 7.55228475,10 7,10 Z'%3E%3C/path%3E%3C/svg%3E");
}

/* === Task Lists (Checkboxes) === */
.ProseMirror ul[data-type="taskList"] {
  list-style: none;
  padding: 0;
  margin: 0;
}

.ProseMirror ul[data-type="taskList"] li {
  display: flex;
  gap: 0.5rem;
  align-items: flex-start;
}

.ProseMirror ul[data-type="taskList"] li > label {
  flex: 0 0 auto;
  margin-right: 0.5rem;
  user-select: none;
}

.ProseMirror ul[data-type="taskList"] li > div {
  flex: 1 1 auto;
}

.ProseMirror ul[data-type="taskList"] input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 1.2em;
  height: 1.2em;
  border: 2px solid hsl(var(--border));
  border-radius: 0.25rem;
  background: hsl(var(--background));
  cursor: pointer;
  position: relative;
  margin: 0.25rem 0 0 0;
  flex-shrink: 0;
}

.ProseMirror ul[data-type="taskList"] input[type="checkbox"]:hover {
  border-color: hsl(var(--primary));
}

.ProseMirror ul[data-type="taskList"] input[type="checkbox"]:checked {
  background: hsl(var(--primary));
  border-color: hsl(var(--primary));
}

.ProseMirror ul[data-type="taskList"] input[type="checkbox"]:checked::after {
  content: "";
  position: absolute;
  left: 0.3em;
  top: 0.05em;
  width: 0.35em;
  height: 0.6em;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

/* === YouTube Embeds === */
div[data-youtube-video] {
  position: relative;
  width: 100%;
  padding-bottom: 56.25%; /* 16:9 aspect ratio */
  height: 0;
  overflow: hidden;
  margin: 1rem 0;
}

div[data-youtube-video] > iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: 0;
  border-radius: 0.5rem;
  cursor: move;
}

.ProseMirror-selectednode iframe {
  outline: 3px solid #fbbf24;
}

/* === Twitter Embeds === */
.twitter-tweet {
  margin: 1rem auto !important;
}

/* === Code Blocks === */
.ProseMirror pre {
  background: hsl(var(--muted));
  color: hsl(var(--foreground));
  font-family: "JetBrainsMono", "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Menlo, Consolas, monospace;
  padding: 0.75rem 1rem;
  border-radius: 0.5rem;
  overflow-x: auto;
  border: 1px solid hsl(var(--border));
}

.ProseMirror pre code {
  color: inherit;
  padding: 0;
  background: none;
  font-size: 0.9rem;
  line-height: 1.5;
}

/* === Gapcursor === */
.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.dark .ProseMirror-gapcursor:after {
  border-top-color: white;
}

/* === Collaboration Cursors === */
.collaboration-cursor__caret {
  border-left: 1px solid #0d0d0d;
  border-right: 1px solid #0d0d0d;
  margin-left: -1px;
  margin-right: -1px;
  pointer-events: none;
  position: relative;
  word-break: normal;
}

.collaboration-cursor__label {
  border-radius: 3px 3px 3px 0;
  color: #0d0d0d;
  font-size: 12px;
  font-style: normal;
  font-weight: 600;
  left: -1px;
  line-height: normal;
  padding: 0.1rem 0.3rem;
  position: absolute;
  top: -1.4em;
  user-select: none;
  white-space: nowrap;
}

/* === Horizontal Rule === */
.ProseMirror hr {
  border: none;
  border-top: 2px solid hsl(var(--border));
  margin: 2rem 0;
}

/* === Fix for bold text in colored/highlighted spans === */
span[style] > strong {
  color: inherit;
}

mark[style] > strong {
  color: inherit;
}

/* === Math (KaTeX) === */
.ProseMirror .math-node {
  display: inline-block;
}

.ProseMirror .math-node.ProseMirror-selectednode {
  outline: 2px solid #5abbf7;
}

/* === highlight.js theme (scoped to pre) === */
pre .hljs-comment,
pre .hljs-quote {
  color: #616161;
}
pre .hljs-variable,
pre .hljs-template-variable,
pre .hljs-attribute,
pre .hljs-tag,
pre .hljs-name,
pre .hljs-regexp,
pre .hljs-link,
pre .hljs-selector-id,
pre .hljs-selector-class {
  color: #f98181;
}
pre .hljs-number,
pre .hljs-meta,
pre .hljs-built_in,
pre .hljs-builtin-name,
pre .hljs-literal,
pre .hljs-type,
pre .hljs-params {
  color: #fbbc88;
}
pre .hljs-string,
pre .hljs-symbol,
pre .hljs-bullet {
  color: #b9f18d;
}
pre .hljs-title,
pre .hljs-section {
  color: #faf594;
}
pre .hljs-keyword,
pre .hljs-selector-tag {
  color: #70cff8;
}
pre .hljs-emphasis {
  font-style: italic;
}
pre .hljs-strong {
  font-weight: 700;
}
